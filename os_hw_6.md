---
date: '2023-09-01'
title: 'OS: Three Easy Pieces [Remzi] <30.Condition Variables> í’€ì´'
categories: ['Operating System']
summary: 'êµì¬ Operating Systems: Three Easy Pieces [Remzi] ì† Homework ë¬¸ì œ í’€ì´'
thumbnail: './os/book2.png'
---
*í•´ë‹¹ í¬ìŠ¤íŠ¸ëŠ” í•„ìê°€ ì§ì ‘ í’€ì´í•œ ê²ƒìœ¼ë¡œ ì˜¤ë‹µì´ë‚˜ ì˜ëª»ëœ í•´ì„ì´ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.*  
*í˜¹ì‹œë‚˜ ì§€ì í•  ë¶€ë¶„ì´ ìˆë‹¤ë©´ í•­ìƒ í™˜ì˜ì…ë‹ˆë‹¤!* ğŸ˜
## ë¬¸ì œ ë° í’€ì´

#### 1. Our first question focuses on main-two-cvs-while.c (the working solution). First, study the code. Do you think you have an understanding of what should happen when you run the program?
í•´ë‹¹ í”„ë¡œê·¸ë¨ì€ `producer`ì™€ `consumer`ë¡œ ì´ë£¨ì–´ì§„ ì—¬ëŸ¬ ì“°ë ˆë“œë¥¼ ìƒì„±í•˜ì—¬ ë²„í¼ì— íŠ¹ì •í•œ ê°’ì„ ì±„ìš°ê³ (`do_fill`) ì½ëŠ”(`do_get`)ê³¼ì •ì„ ë°˜ë³µí•˜ê²Œ ëœë‹¤.  
`producer`ì˜ ê²½ìš°, `mutex_lock` ì‚¬ì´ì˜ ì„¹ì…˜ì— ì ‘ê·¼í•˜ë©´ (`num_full == max`) ì¼ë•Œ `Cond_wait(&empty, &m)`ì„ í†µí•´ ë²„í¼ê°€ ë¹Œë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³ , ë²„í¼ê°€ ë¹„ë©´(í˜¹ì€ ë¹„ì–´ìˆì—ˆìœ¼ë©´) `do_fill(base + i)`ë¥¼ í†µí•´ ì±„ìš´ë‹¤. ì´í›„ `Cond_signal(&fill);`  ì„ í†µí•´ ì°¼ìŒì„ ë‹¤ë¥¸ ì“°ë ˆë“œì—ê²Œ signalì„ í†µí•´ ì•Œë ¤ì¤€ë‹¤.  
`consumer`ì˜ ê²½ìš°, `mutex_lock` ì‚¬ì´ì˜ ì„¹ì…˜ì— ì ‘ê·¼í•˜ë©´ (`num_full == 0`) ì¼ë•Œ `Cond_wait(&fill, &m);`ì„ í†µí•´ ë²„í¼ê°€ ì°°ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  , ë²„í¼ê°€ ì°¨ë©´(í˜¹ì€ ì°¨ìˆì—ˆìœ¼ë©´) `do_get()`ìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤. ì´í›„ `Cond_signal(&empty);`  ì„ í†µí•´ ë¹„ì—ˆìŒì„ ë‹¤ë¥¸ ì“°ë ˆë“œì—ê²Œ signalì„ í†µí•´ ì•Œë ¤ì¤€ë‹¤. `producer`ê°€ ëª¨ë‘ ëë‚˜ë©´ ë²„í¼ë¥¼ `END_OF_STREAM`ë¡œ ì±„ìš°ê²Œ ë˜ê³ , ì´ë¥¼ ë³¸ consumer ë„ ëë‚˜ê²Œ ëœë‹¤.

#### 2. Run with one producer and one consumer, and have the producer produce a few values. Start with a buffer (size 1), and then increase it. How does the behavior of the code change with larger buffers? (or does it?) What would you predict num full to be with differentbuffer sizes (e.g., -m 10) and different numbers of produced items (e.g., -l 100), when you change the consumer sleep string from default (no sleep) to -C 0,0,0,0,0,0,1?

```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 1 -m 1 -v
 NF         P0 C0 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ] p1
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]    c0
  1 [*EOS ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  
Consumer consumption:
  C0 -> 1
```


ë²„í¼ê°€ 1ì¸ ê²½ìš°, `use_ptr`(tracks where next consume should come from) ê³¼ `fill_ptr`(tracks where next produce should go to)ì´ í•­ìƒ ë™ì¼í•˜ì—¬ trace ìƒ ë²„í¼ê°€ í•­ìƒ `*`ë¡œ í‘œì‹œë˜ì–´ ìˆì—ˆë‹¤.
ë²„í¼ê°€ ì—¬ëŸ¬ê°œì¸ ê²½ìš°(ì¦ê°€í•  ê²½ìš°) `producer` ê°€ ë²„í¼ì— í•œì¹¸ì”© ì“°ê³  ë‹¤ìŒìœ¼ë¡œ í¬ì¸í„°ë¥¼ ë„˜ê¸°ê³ ,  `consumer`ë„ í•œì¹¸ì”© ì½ìœ¼ë©° ë‹¤ìŒìœ¼ë¡œ í¬ì¸í„°ë¥¼ ë„˜ê¸´ë‹¤. ë”°ë¼ì„œ ì²˜ìŒì—ëŠ” traceìƒ ë²„í¼ê°€ `*` ì˜€ë‹¤ê°€ ë‹¤ìŒë¶€í„°ëŠ” `fill_ptr`ê°€ ì•ì„œê³  `use_ptr`ê°€ ë”°ë¼ê°€ëŠ” ëª¨ìŠµì„ ë³´ì¸ë‹¤. ìµœì¢…ì ìœ¼ë¡œëŠ” ë‹¤ì‹œ `*`ê°€ ëœë‹¤. ë‹¨, ê·¸ ê³¼ì •ì—ì„œ ë²„í¼ë¥¼ ì½ê³  ì“°ë©´ì„œ í•œì¹¸ì”© ì „ì§„í–ˆê¸°ì— ì›ë˜ ë²„í¼í•˜ê³ ëŠ” ìœ„ì¹˜ê°€ ë‹¬ë¼ì¡Œë‹¤. ì½”ë“œì˜ ì‹¤í–‰ ìˆœì„œëŠ” ë‘ ê²½ìš° ëª¨ë‘ ë™ì¼í–ˆë‹¤. `p0-c0-p1,4,5,6-c1,4,5,6-c0,1,4,5,6` 


 

```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 1 -m 10 -v
 NF                                                      P0 C0 
  0 [*---  ---  ---  ---  ---  ---  ---  ---  ---  --- ] p0
  0 [*---  ---  ---  ---  ---  ---  ---  ---  ---  --- ]    c0
  0 [*---  ---  ---  ---  ---  ---  ---  ---  ---  --- ] p1
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ] p4
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ] p5
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ] p6
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ]    c1
  0 [ --- *---  ---  ---  ---  ---  ---  ---  ---  --- ]    c4
  0 [ --- *---  ---  ---  ---  ---  ---  ---  ---  --- ]    c5
  0 [ --- *---  ---  ---  ---  ---  ---  ---  ---  --- ]    c6
  1 [ --- uEOS f---  ---  ---  ---  ---  ---  ---  --- ] [main: added end-of-stream marker]
  1 [ --- uEOS f---  ---  ---  ---  ---  ---  ---  --- ]    c0
  1 [ --- uEOS f---  ---  ---  ---  ---  ---  ---  --- ]    c1
  0 [ ---  --- *---  ---  ---  ---  ---  ---  ---  --- ]    c4
  0 [ ---  --- *---  ---  ---  ---  ---  ---  ---  --- ]    c5
  0 [ ---  --- *---  ---  ---  ---  ---  ---  ---  --- ]    c6
```


```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 1 -m 1 -l 100 -v
 NF         P0 C0 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ] p1
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  1 [*  0 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p1
  0 [*--- ]    c0
  1 [*  1 ] p4
  1 [*  1 ] p5
  1 [*  1 ] p6
  1 [*  1 ]    c1
  1 [*  1 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p1
  0 [*--- ]    c0
  1 [*  2 ] p4
  1 [*  2 ] p5
  1 [*  2 ] p6
  1 [*  2 ]    c1
  1 [*  2 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p1
  0 [*--- ]    c0
  1 [*  3 ] p4
  1 [*  3 ] p5
  1 [*  3 ] p6
  1 [*  3 ]    c1
  1 [*  3 ] p0

...ìƒëµ

  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p1
  0 [*--- ]    c0
  1 [* 99 ] p4
  1 [* 99 ] p5
  1 [* 99 ] p6
  1 [* 99 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]    c0
  1 [*EOS ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6

Consumer consumption:
  C0 -> 100
```
`-m 10`ì¸ ê²½ìš°, `-m 1` ê³¼ ë¹„êµí–ˆì„ë•Œ num fullê°’ ìì²´ë‚˜ ìˆœì„œê°€ ë‹¬ë¼ì§„ ì ì€ ì—†ì—ˆë‹¤. `-l 100` ì¸ ê²½ìš°, ê°’ì˜ ë²”ìœ„ëŠ” 0,1 ì‚¬ì´ì§€ë§Œ ê°’ì´ ë°”ë€ŒëŠ” ìˆœì„œë‚˜ ìˆœê°„ì´ ì´ì „ê³¼ ë¹„êµí–ˆì„ë•Œ ì¡°ê¸ˆ ë‹¬ë¼ì¡Œë‹¤. pì™€ cê°€ ì‹¤í–‰ë˜ëŠ” ìˆœì„œì— ë”°ë¼ì„œ num full ê°’ë„ ë‹¬ë¼ì§€ëŠ” ëª¨ìŠµì„ ë³´ì¸ë‹¤.
 

```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 1 -m 1 -C 0,0,0,0,0,0,1 -v
 NF         P0 C0 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ] p1
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]    c0
  1 [*EOS ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6

Consumer consumption:
C0 -> 1
```


```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 1 -m 10 -C 0,0,0,0,0,0,1 -v
 NF                                                      P0 C0 
  0 [*---  ---  ---  ---  ---  ---  ---  ---  ---  --- ] p0
  0 [*---  ---  ---  ---  ---  ---  ---  ---  ---  --- ]    c0
  0 [*---  ---  ---  ---  ---  ---  ---  ---  ---  --- ] p1
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ] p4
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ] p5
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ] p6
  1 [u  0 f---  ---  ---  ---  ---  ---  ---  ---  --- ]    c1
  0 [ --- *---  ---  ---  ---  ---  ---  ---  ---  --- ]    c4
  0 [ --- *---  ---  ---  ---  ---  ---  ---  ---  --- ]    c5
  0 [ --- *---  ---  ---  ---  ---  ---  ---  ---  --- ]    c6
  1 [ --- uEOS f---  ---  ---  ---  ---  ---  ---  --- ] [main: added end-of-stream marker]
  1 [ --- uEOS f---  ---  ---  ---  ---  ---  ---  --- ]    c0
  1 [ --- uEOS f---  ---  ---  ---  ---  ---  ---  --- ]    c1
  0 [ ---  --- *---  ---  ---  ---  ---  ---  ---  --- ]    c4
  0 [ ---  --- *---  ---  ---  ---  ---  ---  ---  --- ]    c5
  0 [ ---  --- *---  ---  ---  ---  ---  ---  ---  --- ]    c6

Consumer consumption:
  C0 -> 1
```

`-C 0,0,0,0,0,0,1` ì„ ì ìš©í–ˆì„ë•Œ `-m 1`, `-m 10`ì— ë”°ë¥¸ num fullê°’ ì°¨ì´ëŠ” í¬ê²Œ ì—†ì—ˆë‹¤.



```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 1 -m 1 -l 100 -C 0,0,0,0,0,0,1 -v
 NF         P0 C0 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ] p1
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  1 [*  0 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p1
  1 [*  1 ] p4
  1 [*  1 ] p5
  1 [*  1 ] p6
  1 [*  1 ] p0
  1 [*  1 ] p1
  1 [*  1 ] p2
  1 [*  1 ]    c0
  1 [*  1 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p3
  1 [*  2 ] p4
  1 [*  2 ] p5
  1 [*  2 ] p6
  1 [*  2 ] p0
  1 [*  2 ] p1
  1 [*  2 ] p2
  1 [*  2 ]    c0
  1 [*  2 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p3
  1 [*  3 ] p4
  1 [*  3 ] p5
  1 [*  3 ] p6
  1 [*  3 ] p0
  1 [*  3 ] p1
  1 [*  3 ] p2
^C
```
`-C 0,0,0,0,0,0,1` ì„ ì ìš©í–ˆì„ë•Œ, `-l 100`ì€ ë‹¤ë¥¸ ì–‘ìƒì„ ë³´ì—¬ì¤€ë‹¤. consumer sleepì´ ë°”ë€œì— ë”°ë¼ì„œ pì™€ cê°€ ì‹¤í–‰ë˜ëŠ” ìˆœì„œê°€ ë‹¬ë¼ì§€ê³ , ì´ì— ë”°ë¼ num fullë„ ë‹¬ë¼ì§€ëŠ” ëª¨ìŠµì„ ë³´ì¸ë‹¤.


#### 3. If possible, run the code on different systems (e.g., aMac and Linux). Do you see different behavior across these systems?
`./main-two-cvs-while -p 5 -c 5 -v`
ìœ„ì˜ ì½”ë“œë¥¼ ë¦¬ëˆ…ìŠ¤ì™€ ìœˆë„ìš°ì—ì„œ ì‹¤í–‰ì‹œì¼œ ë³´ì•˜ì„ë•Œ, ë‹¤ìŒê³¼ ê°™ì€ ì°¨ì´ë¥¼ ë³´ì˜€ë‹¤.
   
![1](./os/6_1.png)![2](./os/6_2.png)

#### 4. Letâ€™s look at some timings. How long do you think the following execution, with one producer, three consumers, a single-entry shared buffer, and each consumer pausing at point c3 for a second, will take? ./main-two-cvs-while -p 1 -c 3 -m 1 -C 0,0,0,1,0,0,0:0,0,0,1,0,0,0:0,0,0,1,0,0,0 -l 10 -v -t


```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 3 -m 1 -C 0,0,0,1,0,0,0:0,0,0,1,0,0,0:0,0,0,1,0,0,0 -l 10 -v -t
 NF         P0 C0 C1 C2 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ]          c0
  0 [*--- ]       c0
  0 [*--- ] p1
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  1 [*  0 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c1
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ]       c1
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  1 ] p4
  1 [*  1 ] p5
  1 [*  1 ] p6
  1 [*  1 ]    c1
  1 [*  1 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  2 ] p4
  1 [*  2 ] p5
  1 [*  2 ] p6
  1 [*  2 ]    c1
  1 [*  2 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  3 ] p4
  1 [*  3 ] p5
  1 [*  3 ] p6
  1 [*  3 ]    c1
  1 [*  3 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  4 ] p4
  1 [*  4 ] p5
  1 [*  4 ] p6
  1 [*  4 ]    c1
  1 [*  4 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  5 ] p4
  1 [*  5 ] p5
  1 [*  5 ] p6
  1 [*  5 ]    c1
  1 [*  5 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  6 ] p4
  1 [*  6 ] p5
  1 [*  6 ] p6
  1 [*  6 ]    c1
  1 [*  6 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  7 ] p4
  1 [*  7 ] p5
  1 [*  7 ] p6
  1 [*  7 ]    c1
  1 [*  7 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  8 ] p4
  1 [*  8 ] p5
  1 [*  8 ] p6
  1 [*  8 ]    c1
  1 [*  8 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  9 ] p4
  1 [*  9 ] p5
  1 [*  9 ] p6
  1 [*  9 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]       c2
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]          c3
  0 [*--- ]          c4
  0 [*--- ]          c5
  0 [*--- ]          c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]       c3
  0 [*--- ]       c4
  0 [*--- ]       c5
  0 [*--- ]       c6

Consumer consumption:
  C0 -> 10
  C1 -> 0
  C2 -> 0

Total time: 12.01 seconds
```

ì´ 12ì´ˆê°€ ì†Œìš”ë˜ì—ˆë‹¤. `c3`ì€ `Cond_wait(&fill, &m);` ì— í•´ë‹¹í•˜ëŠ”ë°, í˜„ì¬ ë²„í¼ì— ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê²½ìš° `consumer`ê°€ 1ì´ˆ sleepí•˜ê²Œ ëœë‹¤. ì´í›„ `consumer`ëŠ” ìŠ¤ì¼€ì¤„ë§ì— ë”°ë¼ ë‹¤ë¥¸ `consumer`ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ë„˜ê²¨ì£¼ê²Œ ëœë‹¤. ê° ì‹¤í–‰ë§ˆë‹¤ ì‹¤ì œ ìŠ¤ì¼€ì¤„ë§ì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆê¸´ í•˜ì§€ë§Œ, í•˜ë‚˜ì˜ `consumer`ê°€ ì´ë¯¸ `get`ì„ í•˜ì—¬ì„œ ë‹¤ë¥¸ `consumer`ê°€ í•œë²ˆì”© `sleep`í•˜ê²Œ ëœë‹¤ë©´(ë¦¬ì†ŒìŠ¤ë¥¼ ë†“ì•„ì£¼ì§€ ì•Šì€ì±„ë¡œ) ì „ì²´ ê°’ 10ê°œì™€ eos ë¥¼ ê³ ë ¤í–ˆì„ë•Œ ëŒ€ëµ 11~12ì´ˆ ì •ë„ê°€ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ì„ê¹Œ ì˜ˆìƒí•œë‹¤.

#### 5. Now change the size of the shared buffer to 3 (-m 3). Will thismake any difference in the total time?


```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 3 -m 1 -C 0,0,0,1,0,0,0:0,0,0,1,0,0,0:0,0,0,1,0,0,0 -l 10 -v -t
 NF         P0 C0 C1 C2 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ]          c0
  0 [*--- ]       c0
  0 [*--- ] p1
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  1 [*  0 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c1
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ]       c1
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  1 ] p4
  1 [*  1 ] p5
  1 [*  1 ] p6
  1 [*  1 ]    c1
  1 [*  1 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  2 ] p4
  1 [*  2 ] p5
  1 [*  2 ] p6
  1 [*  2 ]    c1
  1 [*  2 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  3 ] p4
  1 [*  3 ] p5
  1 [*  3 ] p6
  1 [*  3 ]    c1
  1 [*  3 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  4 ] p4
  1 [*  4 ] p5
  1 [*  4 ] p6
  1 [*  4 ]    c1
  1 [*  4 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  5 ] p4
  1 [*  5 ] p5
  1 [*  5 ] p6
  1 [*  5 ]    c1
  1 [*  5 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  6 ] p4
  1 [*  6 ] p5
  1 [*  6 ] p6
  1 [*  6 ]    c1
  1 [*  6 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  7 ] p4
  1 [*  7 ] p5
  1 [*  7 ] p6
  1 [*  7 ]    c1
  1 [*  7 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  8 ] p4
  1 [*  8 ] p5
  1 [*  8 ] p6
  1 [*  8 ]    c1
  1 [*  8 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ] p1
  1 [*  9 ] p4
  1 [*  9 ] p5
  1 [*  9 ] p6
  1 [*  9 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]          c3
  0 [*--- ]    c0
  0 [*--- ]          c2
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c3
  0 [*--- ]       c2
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]          c3
  0 [*--- ]          c4
  0 [*--- ]          c5
  0 [*--- ]          c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]       c3
  0 [*--- ]       c4
  0 [*--- ]       c5
  0 [*--- ]       c6

Consumer consumption:
  C0 -> 10
  C1 -> 0
  C2 -> 0

Total time: 12.01 seconds
```

```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 3 -m 3 -C 0,0,0,1,0,0,0:0,0,0,1,0,0,0:0,0,0,1,0,0,0 
-l 10 -v -t
 NF                   P0 C0 C1 C2 
  0 [*---  ---  --- ] p0
  0 [*---  ---  --- ]    c0
  0 [*---  ---  --- ]       c0
  0 [*---  ---  --- ] p1
  0 [*---  ---  --- ]          c0
  1 [u  0 f---  --- ] p4
  1 [u  0 f---  --- ] p5
  1 [u  0 f---  --- ] p6
  1 [u  0 f---  --- ]    c1
  1 [u  0 f---  --- ] p0
  0 [ --- *---  --- ]    c4
  0 [ --- *---  --- ]    c5
  0 [ --- *---  --- ]    c6
  0 [ --- *---  --- ]       c1
  0 [ --- *---  --- ]    c0
  0 [ --- *---  --- ]       c2
  0 [ --- *---  --- ]          c1
  0 [ --- *---  --- ]          c2
  0 [ --- *---  --- ] p1
  1 [ --- u  1 f--- ] p4
  1 [ --- u  1 f--- ] p5
  1 [ --- u  1 f--- ] p6
  1 [ --- u  1 f--- ]    c1
  1 [ --- u  1 f--- ] p0
  0 [ ---  --- *--- ]    c4
  0 [ ---  --- *--- ]    c5
  0 [ ---  --- *--- ]    c6
  0 [ ---  --- *--- ]       c3
  0 [ ---  --- *--- ]    c0
  0 [ ---  --- *--- ]       c2
  0 [ ---  --- *--- ] p1
  1 [f---  --- u  2 ] p4
  1 [f---  --- u  2 ] p5
  1 [f---  --- u  2 ] p6
  1 [f---  --- u  2 ]    c1
  1 [f---  --- u  2 ] p0
  0 [*---  ---  --- ]    c4
  0 [*---  ---  --- ]    c5
  0 [*---  ---  --- ]    c6
  0 [*---  ---  --- ]          c3
  0 [*---  ---  --- ]    c0
  0 [*---  ---  --- ]          c2
  0 [*---  ---  --- ] p1
  1 [u  3 f---  --- ] p4
  1 [u  3 f---  --- ] p5
  1 [u  3 f---  --- ] p6
  1 [u  3 f---  --- ]    c1
  1 [u  3 f---  --- ] p0
  0 [ --- *---  --- ]    c4
  0 [ --- *---  --- ]    c5
  0 [ --- *---  --- ]    c6
  0 [ --- *---  --- ]       c3
  0 [ --- *---  --- ]    c0
  0 [ --- *---  --- ]       c2
  0 [ --- *---  --- ] p1
  1 [ --- u  4 f--- ] p4
  1 [ --- u  4 f--- ] p5
  1 [ --- u  4 f--- ] p6
  1 [ --- u  4 f--- ]    c1
  1 [ --- u  4 f--- ] p0
  0 [ ---  --- *--- ]    c4
  0 [ ---  --- *--- ]    c5
  0 [ ---  --- *--- ]    c6
  0 [ ---  --- *--- ]          c3
  0 [ ---  --- *--- ]    c0
  0 [ ---  --- *--- ]          c2
  0 [ ---  --- *--- ] p1
  1 [f---  --- u  5 ] p4
  1 [f---  --- u  5 ] p5
  1 [f---  --- u  5 ] p6
  1 [f---  --- u  5 ]    c1
  1 [f---  --- u  5 ] p0
  0 [*---  ---  --- ]    c4
  0 [*---  ---  --- ]    c5
  0 [*---  ---  --- ]    c6
  0 [*---  ---  --- ]       c3
  0 [*---  ---  --- ]    c0
  0 [*---  ---  --- ]       c2
  0 [*---  ---  --- ] p1
  1 [u  6 f---  --- ] p4
  1 [u  6 f---  --- ] p5
  1 [u  6 f---  --- ] p6
  1 [u  6 f---  --- ]    c1
  1 [u  6 f---  --- ] p0
  0 [ --- *---  --- ]    c4
  0 [ --- *---  --- ]    c5
  0 [ --- *---  --- ]    c6
  0 [ --- *---  --- ]          c3
  0 [ --- *---  --- ]    c0
  0 [ --- *---  --- ]          c2
  0 [ --- *---  --- ] p1
  1 [ --- u  7 f--- ] p4
  1 [ --- u  7 f--- ] p5
  1 [ --- u  7 f--- ] p6
  1 [ --- u  7 f--- ]    c1
  1 [ --- u  7 f--- ] p0
  0 [ ---  --- *--- ]    c4
  0 [ ---  --- *--- ]    c5
  0 [ ---  --- *--- ]    c6
  0 [ ---  --- *--- ]       c3
  0 [ ---  --- *--- ]    c0
  0 [ ---  --- *--- ]       c2
  0 [ ---  --- *--- ] p1
  1 [f---  --- u  8 ] p4
  1 [f---  --- u  8 ] p5
  1 [f---  --- u  8 ] p6
  1 [f---  --- u  8 ]    c1
  1 [f---  --- u  8 ] p0
  0 [*---  ---  --- ]    c4
  0 [*---  ---  --- ]    c5
  0 [*---  ---  --- ]    c6
  0 [*---  ---  --- ]          c3
  0 [*---  ---  --- ]    c0
  0 [*---  ---  --- ]          c2
  0 [*---  ---  --- ] p1
  1 [u  9 f---  --- ] p4
  1 [u  9 f---  --- ] p5
  1 [u  9 f---  --- ] p6
  1 [u  9 f---  --- ]    c1
  0 [ --- *---  --- ]    c4
  0 [ --- *---  --- ]    c5
  0 [ --- *---  --- ]    c6
  0 [ --- *---  --- ]       c3
  0 [ --- *---  --- ]    c0
  0 [ --- *---  --- ]       c2
  1 [ --- uEOS f--- ] [main: added end-of-stream marker]
  2 [f--- uEOS  EOS ] [main: added end-of-stream marker]
  3 [ EOS *EOS  EOS ] [main: added end-of-stream marker]
  3 [ EOS *EOS  EOS ]          c3
  2 [ EOS f--- uEOS ]          c4
  2 [ EOS f--- uEOS ]          c5
  2 [ EOS f--- uEOS ]          c6
  2 [ EOS f--- uEOS ]       c3
  1 [uEOS f---  --- ]       c4
  1 [uEOS f---  --- ]       c5
  1 [uEOS f---  --- ]       c6
  1 [uEOS f---  --- ]    c1
  0 [ --- *---  --- ]    c4
  0 [ --- *---  --- ]    c5
  0 [ --- *---  --- ]    c6

Consumer consumption:
  C0 -> 10
  C1 -> 0
  C2 -> 0

Total time: 11.01 seconds
```

ë²„í¼ì˜ ê°œìˆ˜ê°€ 3ê°œë¡œ ëŠ˜ì—ˆì„ ê²½ìš°ì—ë„, ì´ì „ê³¼ ë¹„ìŠ·í•˜ê²Œ 11ì´ˆê°€ ê±¸ë ¸ë‹¤.

#### 6. Now change the location of the sleep to c6 (this models a consumer taking something off the queue and then doing something with it), again using a single-entry buffer. What time do you predict in this case? ./main-two-cvs-while -p 1 -c 3 -m 1 -C 0,0,0,0,0,0,1:0,0,0,0,0,0,1:0,0,0,0,0,0,1 -l 10 -v -t


```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 3 -m 1 -C 0,0,0,0,0,0,1:0,0,0,0,0,0,1:0,0,0,0,0,0,1 -l 10 -v -t
 NF         P0 C0 C1 C2 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ]       c0
  0 [*--- ] p1
  0 [*--- ]          c0
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  1 [*  0 ] p0
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c1
  0 [*--- ]       c2
  0 [*--- ]          c1
  0 [*--- ]          c2
  0 [*--- ] p1
  1 [*  1 ] p4
  1 [*  1 ] p5
  1 [*  1 ] p6
  1 [*  1 ]       c3
  1 [*  1 ] p0
  0 [*--- ]       c4
  0 [*--- ]       c5
  0 [*--- ]       c6
  0 [*--- ] p1
  1 [*  2 ] p4
  1 [*  2 ] p5
  1 [*  2 ] p6
  1 [*  2 ]          c3
  1 [*  2 ] p0
  0 [*--- ]          c4
  0 [*--- ]          c5
  0 [*--- ]          c6
  0 [*--- ] p1
  1 [*  3 ] p4
  1 [*  3 ] p5
  1 [*  3 ] p6
  1 [*  3 ] p0
  1 [*  3 ] p1
  1 [*  3 ] p2
  1 [*  3 ]    c0
  1 [*  3 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p3
  1 [*  4 ] p4
  1 [*  4 ] p5
  1 [*  4 ] p6
  1 [*  4 ] p0
  1 [*  4 ] p1
  1 [*  4 ] p2
  1 [*  4 ]       c0
  1 [*  4 ]       c1
  0 [*--- ]       c4
  0 [*--- ]       c5
  0 [*--- ]       c6
  0 [*--- ] p3
  1 [*  5 ] p4
  1 [*  5 ]          c0
  1 [*  5 ] p5
  1 [*  5 ] p6
  1 [*  5 ]          c1
  1 [*  5 ] p0
  0 [*--- ]          c4
  0 [*--- ]          c5
  0 [*--- ]          c6
  0 [*--- ] p1
  1 [*  6 ] p4
  1 [*  6 ] p5
  1 [*  6 ] p6
  1 [*  6 ] p0
  1 [*  6 ] p1
  1 [*  6 ] p2
  1 [*  6 ]    c0
  1 [*  6 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ] p3
  1 [*  7 ] p4
  1 [*  7 ] p5
  1 [*  7 ] p6
  1 [*  7 ] p0
  1 [*  7 ] p1
  1 [*  7 ] p2
  1 [*  7 ]       c0
  1 [*  7 ]       c1
  0 [*--- ]       c4
  0 [*--- ]       c5
  0 [*--- ]       c6
  0 [*--- ] p3
  1 [*  8 ] p4
  1 [*  8 ] p5
  1 [*  8 ]          c0
  1 [*  8 ] p6
  1 [*  8 ]          c1
  1 [*  8 ] p0
  0 [*--- ]          c4
  0 [*--- ]          c5
  0 [*--- ]          c6
  0 [*--- ] p1
  1 [*  9 ] p4
  1 [*  9 ] p5
  1 [*  9 ] p6
  1 [*  9 ]    c0
  1 [*  9 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]       c0
  1 [*EOS ]       c1
  0 [*--- ]       c4
  0 [*--- ]       c5
  0 [*--- ]       c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]          c0
  1 [*EOS ]          c1
  0 [*--- ]          c4
  0 [*--- ]          c5
  0 [*--- ]          c6
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]    c0
  1 [*EOS ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6

Consumer consumption:
  C0 -> 4
  C1 -> 3
  C2 -> 3

Total time: 5.00 seconds
```

ì´ë²ˆì—ëŠ” sleep ì‹œì ì´ `c6`  `Mutex_unlock(&m);` ì„ì„ ê³ ë ¤í•˜ë©´ ì €ë²ˆê³¼ëŠ” ë‹¤ë¥´ê²Œ ë¦¬ì†ŒìŠ¤ë¥¼ í’€ì–´ì£¼ê³  lockì„ í•˜ê²Œëœë‹¤. ë”°ë¼ì„œ ê¸°ì¡´ê³¼ ê°™ì´ 11~12ì´ˆë¥¼ í—ˆë¹„í•˜ì§€ ì•Šê³ , ê·¸ì‚¬ì´ì— ë‹¤ë¥¸ consumerë“¤ì´ producerì˜ ê°’ì„ ë°›ë‹¤ë³´ë‹ˆ 5ì´ˆë°–ì— ê±¸ë¦¬ì§€ ì•Šì•˜ë‹¤.

#### 7. Finally, change the buffer size to 3 again (-m 3). What time do you predict now?


```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while -p 1 -c 3 -m 3 -C 0,0,0,0,0,0,1:0,0,0,0,0,0,1:0,0,0,0,0,0,1 
-l 10 -v -t
 NF                   P0 C0 C1 C2 
  0 [*---  ---  --- ] p0
  0 [*---  ---  --- ]    c0
  0 [*---  ---  --- ]       c0
  0 [*---  ---  --- ] p1
  0 [*---  ---  --- ]          c0
  1 [u  0 f---  --- ] p4
  1 [u  0 f---  --- ] p5
  1 [u  0 f---  --- ] p6
  1 [u  0 f---  --- ]    c1
  1 [u  0 f---  --- ] p0
  0 [ --- *---  --- ]    c4
  0 [ --- *---  --- ]    c5
  0 [ --- *---  --- ]    c6
  0 [ --- *---  --- ]       c1
  0 [ --- *---  --- ]       c2
  0 [ --- *---  --- ]          c1
  0 [ --- *---  --- ]          c2
  0 [ --- *---  --- ] p1
  1 [ --- u  1 f--- ] p4
  1 [ --- u  1 f--- ] p5
  1 [ --- u  1 f--- ] p6
  1 [ --- u  1 f--- ]       c3
  1 [ --- u  1 f--- ] p0
  0 [ ---  --- *--- ]       c4
  0 [ ---  --- *--- ]       c5
  0 [ ---  --- *--- ]       c6
  0 [ ---  --- *--- ] p1
  1 [f---  --- u  2 ] p4
  1 [f---  --- u  2 ] p5
  1 [f---  --- u  2 ] p6
  1 [f---  --- u  2 ]          c3
  1 [f---  --- u  2 ] p0
  0 [*---  ---  --- ]          c4
  0 [*---  ---  --- ]          c5
  0 [*---  ---  --- ]          c6
  0 [*---  ---  --- ] p1
  1 [u  3 f---  --- ] p4
  1 [u  3 f---  --- ] p5
  1 [u  3 f---  --- ] p6
  1 [u  3 f---  --- ] p0
  1 [u  3 f---  --- ] p1
  2 [u  3    4 f--- ] p4
  2 [u  3    4 f--- ] p5
  2 [u  3    4 f--- ] p6
  2 [u  3    4 f--- ] p0
  2 [u  3    4 f--- ] p1
  3 [*  3    4    5 ] p4
  3 [*  3    4    5 ] p5
  3 [*  3    4    5 ] p6
  3 [*  3    4    5 ] p0
  3 [*  3    4    5 ] p1
  3 [*  3    4    5 ] p2
  3 [*  3    4    5 ]    c0
  3 [*  3    4    5 ]    c1
  2 [f--- u  4    5 ]    c4
  2 [f--- u  4    5 ]    c5
  2 [f--- u  4    5 ]    c6
  2 [f--- u  4    5 ] p3
  3 [   6 *  4    5 ] p4
  3 [   6 *  4    5 ] p5
  3 [   6 *  4    5 ] p6
  3 [   6 *  4    5 ] p0
  3 [   6 *  4    5 ] p1
  3 [   6 *  4    5 ] p2
  3 [   6 *  4    5 ]       c0
  3 [   6 *  4    5 ]       c1
  2 [   6 f--- u  5 ]       c4
  2 [   6 f--- u  5 ]       c5
  2 [   6 f--- u  5 ]       c6
  2 [   6 f--- u  5 ] p3
  3 [   6    7 *  5 ] p4
  3 [   6    7 *  5 ] p5
  3 [   6    7 *  5 ]          c0
  3 [   6    7 *  5 ] p6
  3 [   6    7 *  5 ]          c1
  3 [   6    7 *  5 ] p0
  2 [u  6    7 f--- ]          c4
  2 [u  6    7 f--- ]          c5
  2 [u  6    7 f--- ]          c6
  2 [u  6    7 f--- ] p1
  3 [*  6    7    8 ] p4
  3 [*  6    7    8 ] p5
  3 [*  6    7    8 ] p6
  3 [*  6    7    8 ] p0
  3 [*  6    7    8 ] p1
  3 [*  6    7    8 ] p2
  3 [*  6    7    8 ]    c0
  3 [*  6    7    8 ]    c1
  2 [f--- u  7    8 ]    c4
  2 [f--- u  7    8 ]    c5
  2 [f--- u  7    8 ]    c6
  2 [f--- u  7    8 ] p3
  3 [   9 *  7    8 ] p4
  3 [   9 *  7    8 ] p5
  3 [   9 *  7    8 ] p6
  3 [   9 *  7    8 ]       c0
  3 [   9 *  7    8 ]       c1
  2 [   9 f--- u  8 ]       c4
  2 [   9 f--- u  8 ]       c5
  2 [   9 f--- u  8 ]       c6
  3 [   9  EOS *  8 ] [main: added end-of-stream marker]
  3 [   9  EOS *  8 ]          c0
  3 [   9  EOS *  8 ]          c1
  2 [u  9  EOS f--- ]          c4
  2 [u  9  EOS f--- ]          c5
  2 [u  9  EOS f--- ]          c6
  3 [*  9  EOS  EOS ] [main: added end-of-stream marker]
  3 [*  9  EOS  EOS ]    c0
  3 [*  9  EOS  EOS ]    c1
  2 [f--- uEOS  EOS ]    c4
  2 [f--- uEOS  EOS ]    c5
  2 [f--- uEOS  EOS ]    c6
  3 [ EOS *EOS  EOS ] [main: added end-of-stream marker]
  3 [ EOS *EOS  EOS ]       c0
  3 [ EOS *EOS  EOS ]       c1
  2 [ EOS f--- uEOS ]       c4
  2 [ EOS f--- uEOS ]       c5
  2 [ EOS f--- uEOS ]       c6
  2 [ EOS f--- uEOS ]          c0
  2 [ EOS f--- uEOS ]          c1
  1 [uEOS f---  --- ]          c4
  1 [uEOS f---  --- ]          c5
  1 [uEOS f---  --- ]          c6
  1 [uEOS f---  --- ]    c0
  1 [uEOS f---  --- ]    c1
  0 [ --- *---  --- ]    c4
  0 [ --- *---  --- ]    c5
  0 [ --- *---  --- ]    c6

Consumer consumption:
  C0 -> 4
  C1 -> 3
  C2 -> 3

Total time: 5.00 seconds
```

ë²„í¼ í¬ê¸°ê°€ 3ì¼ë•Œë„ ë™ì¼í•˜ê²Œ 5ì´ˆê°€ ì†Œìš”ë˜ì—ˆë‹¤.

#### 8. Now letâ€™s look at main-one-cv-while.c. Can you configure a sleep string, assuming a single producer, one consumer, and a buffer of size 1, to cause a problem with this code?
í•˜ë‚˜ì˜ `producer`ì™€ í•˜ë‚˜ì˜`consumer`, ë²„í¼ì‚¬ì´ì¦ˆ 1ë§Œìœ¼ë¡œëŠ” ë¬¸ì œë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ê°€ ì—†ë‹¤ê³  ìƒê°í–ˆë‹¤. ì—¬ëŸ¬ `consumer`(í˜¹ì€ `producer`) ì“°ë ˆë“œê°€ ì‹¤í–‰ë˜ì•¼ì§€ ì„œë¡œì˜ ë™ì‹œì„± ë¬¸ì œê°€ ë°œìƒë˜ê¸° ë•Œë¬¸ì´ë‹¤.

#### 9. Now change the number of consumers to two. Can you construct sleep strings for the producer and the consumers so as to cause a problem in the code? 

```c
2019312219@swji:~/hw/6$ ./main-one-cv-while -c 2 -v -P 0,0,0,0,0,0,1
 NF         P0 C0 C1 
  0 [*--- ] p0
  0 [*--- ]    c0
  0 [*--- ]       c0
  0 [*--- ] p1
  1 [*  0 ] p4
  1 [*  0 ] p5
  1 [*  0 ] p6
  1 [*  0 ]    c1
  0 [*--- ]    c4
  0 [*--- ]    c5
  0 [*--- ]    c6
  0 [*--- ]       c1
  0 [*--- ]    c0
  0 [*--- ]       c2
  0 [*--- ]    c1
  0 [*--- ]    c2
  1 [*EOS ] [main: added end-of-stream marker]
  1 [*EOS ]       c3
  0 [*--- ]       c4
  0 [*--- ]       c5
  0 [*--- ]       c6
  0 [*--- ]    c3
  0 [*--- ]    c2
^C


```
`./main-one-cv-while -c 2 -v -P 0,0,0,0,0,0,1`
ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ê²½ìš° 2ê°œì˜ ì“°ë ˆë“œê°€ ê³„ì† sleepí•˜ê²Œ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

#### 10. Now examine main-two-cvs-if.c. Can you cause a problem to happen in this code? Again consider the case where there is only one consumer, and then the case where there is more than one.
consumerê°€ 2ëª… ì´ìƒì¼ ê²½ìš°ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì´ ê°€ëŠ¥í•˜ë‹¤. consumer1ê°€ ë²„í¼ê°€ ë¹„ì–´ìˆì–´ waitë¥¼ í•˜ê³ ìˆëŠ” ì¤‘ì´ê³ , producerê°€ ì°¨ìˆë‹¤ëŠ” ì‹œê·¸ë„ì„ ë³´ë‚¸ ê²½ìš°ë¥¼ ìƒê°í•´ë³´ì. ì´ë•Œ consumer1ì´ waitì—ì„œ ê¹¨ì–´ë‚˜ì„œ ë½ì„ í’€ê³  getí•˜ê¸° ì „ì— consumer2 ê°€ ë¨¼ì € ìŠ¤ì¼€ì¤„ë§ë˜ì–´ ì¡´ì¬í•˜ëŠ” ë²„í¼ì—ì„œ getì„ í•  ê²½ìš°, consumer1ì´ ì‹œê·¸ë„ì„ ë°›ê³  ê¹¨ì–´ë‚˜ë”ë¼ë„ ê·¸ë•ŒëŠ” ë²„í¼ì— getí•  ê²ƒì´ ë‚¨ì•„ìˆì§€ ì•Šë‹¤. ì´ë•Œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
#### 11. Finally, examine main-two-cvs-while-extra-unlock.c. What problem arises when you release the lock before doing a put or a get? Can you reliably cause such a problem to happen, given the sleep strings? What bad thing can happen?
putì´ë‚˜ get ì „ì— lockì„ í’€ê²Œë˜ë©´ ë‹¤ë¥¸ ì“°ë ˆë“œì—ì„œ ë„ì¤‘ì— ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ê°€ê²Œ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. lockì´ ì ì‹œ í’€ë¦¬ëŠ” ë¶€ë¶„ì— í•´ë‹¹í•˜ëŠ” `tmp = do_get(); c4;` ì— sleep strings ì„ 1ë¡œ ì£¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëœë‹¤. ë‹¨, ë¹„êµë¥¼ ìœ„í•´ ë‘ê°œì˜ consumerì¤‘ í•˜ë‚˜ì—ë§Œ ì ìš©.

```c
2019312219@swji:~/hw/6$ ./main-two-cvs-while-extra-unlock -p 1 -c 2 -m 5 1 -l 10 -v -C 0,0,0,0,1,0,0:0,0,
0,0,0,0,0
 NF                             P0 C0 C1 
  0 [*---  ---  ---  ---  --- ] p0
  0 [*---  ---  ---  ---  --- ]    c0
  0 [*---  ---  ---  ---  --- ]       c0
  0 [*---  ---  ---  ---  --- ] p1
  1 [u  0 f---  ---  ---  --- ] p4
  1 [u  0 f---  ---  ---  --- ]    c1
  0 [ --- *---  ---  ---  --- ]    c4
  0 [ --- *---  ---  ---  --- ]       c1
  0 [ --- *---  ---  ---  --- ]       c2
  0 [ --- *---  ---  ---  --- ] p5
  0 [ --- *---  ---  ---  --- ] p6
  0 [ --- *---  ---  ---  --- ]       c3
  0 [ --- *---  ---  ---  --- ] p0
  0 [ --- *---  ---  ---  --- ]       c2
  0 [ --- *---  ---  ---  --- ] p1
  1 [ --- u  1 f---  ---  --- ] p4
  1 [ --- u  1 f---  ---  --- ] p5
  1 [ --- u  1 f---  ---  --- ] p6
  1 [ --- u  1 f---  ---  --- ]       c3
  1 [ --- u  1 f---  ---  --- ] p0
  0 [ ---  --- *---  ---  --- ]       c4
  0 [ ---  --- *---  ---  --- ] p1
  1 [ ---  --- u  2 f---  --- ] p4
  1 [ ---  --- u  2 f---  --- ]       c5
  1 [ ---  --- u  2 f---  --- ]       c6
  1 [ ---  --- u  2 f---  --- ] p5
  1 [ ---  --- u  2 f---  --- ]       c0
  1 [ ---  --- u  2 f---  --- ] p6
  1 [ ---  --- u  2 f---  --- ]       c1
  1 [ ---  --- u  2 f---  --- ] p0
  0 [ ---  ---  --- *---  --- ]       c4
  0 [ ---  ---  --- *---  --- ] p1
  1 [ ---  ---  --- u  3 f--- ] p4
  1 [ ---  ---  --- u  3 f--- ]       c5
  1 [ ---  ---  --- u  3 f--- ]       c6
  1 [ ---  ---  --- u  3 f--- ] p5
  1 [ ---  ---  --- u  3 f--- ]       c0
  1 [ ---  ---  --- u  3 f--- ] p6
  1 [ ---  ---  --- u  3 f--- ]       c1
  1 [ ---  ---  --- u  3 f--- ] p0
  0 [ ---  ---  ---  --- *--- ]       c4
  0 [ ---  ---  ---  --- *--- ] p1
  1 [f---  ---  ---  --- u  4 ] p4
  1 [f---  ---  ---  --- u  4 ]       c5
  1 [f---  ---  ---  --- u  4 ]       c6
  1 [f---  ---  ---  --- u  4 ] p5
  1 [f---  ---  ---  --- u  4 ]       c0
  1 [f---  ---  ---  --- u  4 ] p6
  1 [f---  ---  ---  --- u  4 ]       c1
  1 [f---  ---  ---  --- u  4 ] p0
  0 [*---  ---  ---  ---  --- ]       c4
  0 [*---  ---  ---  ---  --- ] p1
  1 [u  5 f---  ---  ---  --- ] p4
  1 [u  5 f---  ---  ---  --- ]       c5
  1 [u  5 f---  ---  ---  --- ]       c6
  1 [u  5 f---  ---  ---  --- ] p5
  1 [u  5 f---  ---  ---  --- ]       c0
  1 [u  5 f---  ---  ---  --- ] p6
  1 [u  5 f---  ---  ---  --- ]       c1
  1 [u  5 f---  ---  ---  --- ] p0
  0 [ --- *---  ---  ---  --- ]       c4
  0 [ --- *---  ---  ---  --- ] p1
  1 [ --- u  6 f---  ---  --- ] p4
  1 [ --- u  6 f---  ---  --- ]       c5
  1 [ --- u  6 f---  ---  --- ]       c6
  1 [ --- u  6 f---  ---  --- ] p5
  1 [ --- u  6 f---  ---  --- ]       c0
  1 [ --- u  6 f---  ---  --- ] p6
  1 [ --- u  6 f---  ---  --- ]       c1
  1 [ --- u  6 f---  ---  --- ] p0
  0 [ ---  --- *---  ---  --- ]       c4
  0 [ ---  --- *---  ---  --- ] p1
  1 [ ---  --- u  7 f---  --- ] p4
  1 [ ---  --- u  7 f---  --- ]       c5
  1 [ ---  --- u  7 f---  --- ]       c6
  1 [ ---  --- u  7 f---  --- ] p5
  1 [ ---  --- u  7 f---  --- ]       c0
  1 [ ---  --- u  7 f---  --- ] p6
  1 [ ---  --- u  7 f---  --- ]       c1
  1 [ ---  --- u  7 f---  --- ] p0
  0 [ ---  ---  --- *---  --- ]       c4
  0 [ ---  ---  --- *---  --- ] p1
  1 [ ---  ---  --- u  8 f--- ] p4
  1 [ ---  ---  --- u  8 f--- ]       c5
  1 [ ---  ---  --- u  8 f--- ]       c6
  1 [ ---  ---  --- u  8 f--- ] p5
  1 [ ---  ---  --- u  8 f--- ]       c0
  1 [ ---  ---  --- u  8 f--- ] p6
  1 [ ---  ---  --- u  8 f--- ]       c1
  1 [ ---  ---  --- u  8 f--- ] p0
  0 [ ---  ---  ---  --- *--- ]       c4
  0 [ ---  ---  ---  --- *--- ] p1
  1 [f---  ---  ---  --- u  9 ] p4
  1 [f---  ---  ---  --- u  9 ]       c5
  1 [f---  ---  ---  --- u  9 ]       c6
  1 [f---  ---  ---  --- u  9 ] p5
  1 [f---  ---  ---  --- u  9 ]       c0
  1 [f---  ---  ---  --- u  9 ] p6
  1 [f---  ---  ---  --- u  9 ]       c1
  0 [*---  ---  ---  ---  --- ]       c4
  1 [uEOS f---  ---  ---  --- ] [main: added end-of-stream marker]
  2 [uEOS  EOS f---  ---  --- ] [main: added end-of-stream marker]
  2 [uEOS  EOS f---  ---  --- ]       c5
  2 [uEOS  EOS f---  ---  --- ]       c6
  2 [uEOS  EOS f---  ---  --- ]       c0
  2 [uEOS  EOS f---  ---  --- ]       c1
  1 [ --- uEOS f---  ---  --- ]       c4
  1 [ --- uEOS f---  ---  --- ]       c5
  1 [ --- uEOS f---  ---  --- ]       c6
  1 [ --- uEOS f---  ---  --- ]    c5
  1 [ --- uEOS f---  ---  --- ]    c6
  1 [ --- uEOS f---  ---  --- ]    c0
  1 [ --- uEOS f---  ---  --- ]    c1
  0 [ ---  --- *---  ---  --- ]    c4
  0 [ ---  --- *---  ---  --- ]    c5
  0 [ ---  --- *---  ---  --- ]    c6

Consumer consumption:
  C0 -> 1
  C1 -> 9
```
consumer1ì—ì„œ c4ì— ì ì‹œ lockì´ í’€ë¦°ì‚¬ì´(sleep stringsì˜í–¥) ë‹¤ë¥¸ ì“°ë ˆë“œê°€ ì‹¤í–‰ë˜ì–´ ì´í›„ë¡œë„ consumer1ì´ ê³„ì† í• ë‹¹ë˜ì§€ ëª»í•˜ëŠ” ëª¨ìŠµì„ ë³´ì—¬ì¤€ë‹¤.

## Source

- ã€Operating Systems: Three Easy Piecesã€ *-Remzi H. Arpaci-Dusseau ì§€ìŒ*  
  [https://pages.cs.wisc.edu/~remzi/OSTEP/](https://pages.cs.wisc.edu/~remzi/OSTEP/)